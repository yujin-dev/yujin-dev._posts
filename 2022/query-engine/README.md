

# How RDB vs. Data Warehouse query data?
- RDB에서 데이터를 조회하는 원리
- DataWarehouse에서 데이터를 조회하는 원리

Data Scanning in RDB
- Index scan
- Full scan
- hash scan

보통 인덱스 스캔을 통해 데이터를 조회하고, 속도가 더 빠르다고 할 수 있음. 
RDB에서는 디스크 I/O를 줄이는 것이 쿼리 성능에 연결됨. 디스크 I/O 병목을 줄이는 것이 가장 중요. 
그렇다면 RDB에서 데이터를 검색하는 방법이 어떻게 되나? 
인덱스 스캔의 경우: PK 전용 메타 테이블이 있을 것이다. PK를 기준으로 정렬되어 있고 여기서 binary search가 적용된다. 인덱스에 해당되는 값을 찾으면 매핑된 포인터 정보를 통해 실제 데이터의 위치를 파악할 수 있다. 그럼 실제 테이블에서 해당되는 포인터의 튜플들을 반환한다. 
(예를 들어 PostgreSQL을 통해 파악해보자?)

Data Warehouse에서는 다를까? 어떻게 보면 RDB에서의 full scan이라고 할 수 있음. 하지만 그 많은 데이터를 전체 검색할 수 있어 빠르게 조회할 수 있을까? 아닐 것. 여기서 맵리듀스가 적용될 것이다. 맵리듀스는 Map: 쿼리를 쪼개서 탐색하고, Reduce: 조회 결과를 병합하여 반환하게 된다. 여기서는 어떻게 쿼리하는지에 대한 query plan보다 투입되는 컴퓨팅 엔진의 성능이 중요할 것이다.(왜?) CPU, Memory 등 많은 리소스를 투입하면 더 쪼개서? 쪼개서 찾는 것이 더 빠르니까? 병합할때는 오래 걸리지 않나? 디스크 I/O 병목은? 분산된 스토리지에서 데이터를 올려 찾은 후에 통합한다. 

데이터 사이즈가 작으면 분산 처리로 인한 지연 시간이 더 걸릴 것이나, 사이즈가 크면 RDB 클러스터로 활용할 수 있는 리소스 한계를 극복하게 된다. 애초에 DB에서 할당할 수 있는 리소스에 물리적 한계가 있을 것이다. 파티셔닝을 통해 데이터를 분산해서 저장이 가능하나 여기서 저장되어 있는 데이터의 위치가 균등하지 않다면 하나의 서버에서 워크로드가 크게 발생할 것이다. Data Warehouse는 애초에 스토리지가 분리되어 있고, 아주 작은 단위( micropartition )로 쪼개져 있어( Snowflake의 경우 ) 데이터 삽입 및 삭제가 용이하다. DB에서 서버를 최적화해야 하는 문제가 없을터이다. 