# [INFO] 
> https://docs.snowflake.com/en/sql-reference/sql/show-schemas.html

# [ERROR]
다음 코드가 있다.
```python
def _grant_read_permission_to_database(name:str, roles:list):
    snowflake.DatabaseGrant(name+"-usage-DatabaseGrant", database_name=name, privilege="USAGE", enable_multiple_grants=True, roles=roles, with_grant_option=False)
    snowflake.DatabaseGrant(name+"-ref-usage-DatabaseGrant", database_name=name, privilege="REFERENCE_USAGE", enable_multiple_grants=True, roles=roles, with_grant_option=False)

    snowflake.SchemaGrant(name+"-future-usage-SchemaGrant", database_name=name, on_future=True, privilege= "USAGE", enable_multiple_grants=True, roles=roles, with_grant_option=False)

    snowflake.TableGrant(name+"-future-usage-TableGrant", database_name=name, on_future=True, privilege= "SELECT", enable_multiple_grants=True, roles=roles, with_grant_option=False)
    snowflake.TableGrant(name+"-future-ref-TableGrant", database_name=name, on_future=True, privilege= "REFERENCES", enable_multiple_grants=True, roles=roles, with_grant_option=False)

    snowflake.ViewGrant(name+"-future-usage-ViewGrant", database_name=name, on_future=True, privilege= "SELECT", enable_multiple_grants=True, roles=roles, with_grant_option=False)
    snowflake.ViewGrant(name+"-future-ref-ViewGrant", database_name=name, on_future=True, privilege= "REFERENCES", enable_multiple_grants=True, roles=roles, with_grant_option=False)
    
    current_tables = execute_query(query="select table_schema, table_name, table_type from information_schema.tables where table_schema != 'INFORMATION_SCHEMA';", database=name)
    schemas = current_tables['table_schema'].unique()

    for schema in schemas:
        snowflake.SchemaGrant(name+f"-all-{schema}-SchemaGrant", database_name=name, schema_name=schema, privilege= "USAGE", enable_multiple_grants=True, roles=roles, with_grant_option=False)

    for _, row in current_tables.iterrows():
        if row['table_type'] == "VIEW":
            snowflake.ViewGrant(name+f"-{row['table_name']}-select-ViewGrant", database_name=name, schema_name=row['table_schema'], view_name=row['table_name'], privilege= "SELECT", enable_multiple_grants=True, roles=roles, with_grant_option=False)
            snowflake.ViewGrant(name+f"-{row['table_name']}-ref-ViewGrant", database_name=name, schema_name=row['table_schema'], view_name=row['table_name'], privilege= "REFERENCES", enable_multiple_grants=True, roles=roles, with_grant_option=False)
        else:
            snowflake.TableGrant(name+f"-{row['table_name']}-select-TableGrant", database_name=name, schema_name=row['table_schema'], table_name=row['table_name'], privilege= "SELECT", enable_multiple_grants=True, roles=roles, with_grant_option=False)
            snowflake.TableGrant(name+f"-{row['table_name']}-ref-TableGrant", database_name=name, schema_name=row['table_schema'], table_name=row['table_name'], privilege= "REFERENCES", enable_multiple_grants=True, roles=roles, with_grant_option=False)


_grant_read_permission_to_database(name=db1, roles=["PUBLIC"])
_grant_read_permission_to_database(name=db2, roles=["PUBLIC"])
_grant_read_permission_to_database(name=db3, roles=["PUBLIC"])
_grant_read_permission_to_database(name=db4, roles=["PUBLIC"])

>> pulumi up
```

위에서 각 4개의 DB에 연결하여 기존의 schema, table를 가져오는데 4개로 하면 마지막 DB에서 DB가 반영되지 않은 오류가 난다.
```
    sqlalchemy.exc.ProgrammingError: (snowflake.connector.errors.ProgrammingError) 090105 (22000): Cannot perform SELECT. This session does not have a current database. Call 'USE DATABASE', or use a qualified name.
    [SQL: select table_schema, table_name, table_type from information_schema.tables where table_schema != 'INFORMATION_SCHEMA';]
```
3개는 된다..
연결을 따로 해서 문제인건가..?

# [INFO] snowflake `enable_multiple_grants`
똑같은 권한이 중복해서 생기게 된다. iac 외부에서 권한이 취소되지 않는 것을 방지하기 위함이라고 한다.
Grant마다 동일한 권한이 여러 개 생성될 수 있다. 

```sql
> show grants to role PUBLIC;
--------
created_on	                  privilege	granted_on	name	granted_to	grantee_name	grant_option	granted_by
2022-07-06 04:38:50.945 -0700	REFERENCE_USAGE	DATABASE	DB1	ROLE	PUBLIC	false	ACCOUNTADMIN
2022-07-06 04:38:50.945 -0700	REFERENCE_USAGE	DATABASE	DB1	ROLE	PUBLIC	false	ACCOUNTADMIN
2022-07-06 04:38:50.945 -0700	REFERENCE_USAGE	DATABASE	DB1	ROLE	PUBLIC	false	ACCOUNTADMIN
2022-07-06 04:38:50.945 -0700	REFERENCE_USAGE	DATABASE	DB1	ROLE	PUBLIC	false	ACCOUNTADMIN
2022-07-06 04:38:50.945 -0700	REFERENCE_USAGE	DATABASE	DB1	ROLE	PUBLIC	false	ACCOUNTADMIN
20...

# [INFO] GitHub에서 Release/Tag 자동 생성 
> [GitHub에서 Release/Tag 자동으로 만들어 주기](https://medium.com/prnd/github%EC%97%90%EC%84%9C-release-tag-%EC%9E%90%EB%8F%99%EC%9C%BC%EB%A1%9C-%EB%A7%8C%EB%93%A4%EC%96%B4-%EC%A3%BC%EA%B8%B0-1%EB%B6%84%EB%A7%8C%EC%97%90-%EC%84%A4%EC%A0%95-5c09a383fb08)

