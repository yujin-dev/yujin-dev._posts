---
layout: post
title: How RDB and DW query data
categories: [Database]
date: 2022-04-13
---

# Difference in querying between RDB and DW?
- RDB에서 데이터를 조회하는 원리
- DataWarehouse에서 데이터를 조회하는 원리

## Querying in RDB
RDB에서 데이터 스캔은 Index scan, Full scan, Hash scan 등이 있다. 보통 인덱스 스캔을 통해 데이터를 조회하고, 쿼리가 복잡하지 않은 경우 속도가 더 빠르다.   
RDB에서는 디스크 I/O가 쿼리 성능에 연결되어 디스크 I/O 병목을 줄이는 것이 중요하다.

### 그렇다면 RDB에서 데이터를 검색하는 방법이 어떻게 되나? 
인덱스 스캔의 경우, 우선 Primary Key 전용 메타 테이블이 있을 것이다. 데이터는 PK를 기준으로 정렬되어 있고 검색할 때 binary search가 적용된다. 인덱스에 해당되는 값을 찾아 매핑된 포인터 정보를 통해 실제 데이터의 위치를 파악할 수 있다. 그럼 실제 테이블에서 해당되는 포인터의 튜플들을 반환하게 된다.

## Querying in DW
Data Warehouse에서는 다를까? 어떻게 보면 RDB에서의 full scan이라고 할 수 있다. 하지만 그 많은 데이터를 어떻게 조회하여 원하는 데이터를 빠르게 찾을 수 있을까? 여기서 맵리듀스가 적용될 것이다. 

맵리듀스는
- Map: 쿼리를 쪼개서 탐색하고, 
- Reduce: 조회 결과를 병합하여 반환하는 방식이다. 

여기서는 어떻게 쿼리하는지에 대한 옵티마이저보다 투입되는 컴퓨팅 엔진의 성능이 중요할 것이다.

### Difference?
데이터 사이즈가 작으면 분산 처리로 인한 지연 시간이 더 걸릴 것이나, 사이즈가 크면 RDB 클러스터로 활용할 수 있는 리소스 한계를 극복하게 된다. 애초에 DB에서 할당할 수 있는 리소스에 물리적 한계가 있을 것이다. 파티셔닝을 통해 데이터를 분산해서 저장이 가능하나 여기서 저장되어 있는 데이터의 위치가 균등하지 않다면 하나의 서버에서 워크로드가 크게 발생할 것이다.  
Data Warehouse는 스토리지가 분리되어 있고, 아주 작은 단위( Snowflake의 경우, micropartition )로 쪼개져 있어 데이터 삽입 및 삭제가 용이하다. 데이터베이스 단계에서 서버를 최적화해야 하는 문제가 없을 것이다.