---
title: "Elasticsearch Document 살펴보기"
category: "search_engine"
---

Elasticsearch Udemy 강의( *Complete Guide to Elastticsearch* )를 보면서 document에서 정리할 내용을 기록한다. 

## Search Query
*search query*는 Elasticsearch data streams / indices의 데이터를 요청하는 쿼리를 의미한다. 

### Search API 
- https://www.elastic.co/guide/en/elasticsearch/reference/current/search-your-data.html#run-an-es-search

아래는 `match` 쿼리로 `my-index-000001`를 탐색하는 요청 예시다. 

[ 예시 ] `user.id` = `kimchy`인 document를 검색
```sh
GET /my-index-000001/_search
{
  "query": {
    "match": {
      "user.id": "kimchy"
    }
  }
}
```

[ 결과 ] 기본적으로 score가 가장 높은 10개 문서를 가져온다.(문서 갯수는 설정할 수 있음)
```sh 
{
  "took": 5, 
  "timed_out": false, 
  "_shards": { # sharding에 대한 정보 
    "total": 1, # 전체 shards = 1
    "successful": 1, # 성공 = 1
    "skipped": 0,
    "failed": 0 # 실패 = 1
  },
  "hits": { # 실제 결과에 대한 정보
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.3862942, # score 중 가장 높은 값
    "hits": [ # documents 
      {
        "_index": "my-index-000001",
        "_type": "_doc",
        "_id": "kxWFcnMByiguvud1Z8vC",
        "_score": 1.3862942,  # relevance score
        "_source": { 
          "@timestamp": "2099-11-15T14:12:12",
          "http": {
            "request": {
              "method": "get" 
            },
            "response": {
              "bytes": 1070000,
              "status_code": 200
            },
            "version": "1.1"
          },
          "message": "GET /search HTTP/1.1 200 1070000",
          "source": {
            "ip": "127.0.0.1"
          },
          "user": {
            "id": "kimchy"
          }
        }
      }
    ]
  }
}
```

## Sharding
### Index Shart Allocation
- https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-allocation-filtering.html
